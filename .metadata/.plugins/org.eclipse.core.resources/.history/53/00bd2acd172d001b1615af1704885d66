//***********************************************************************************
// Include files
//***********************************************************************************
#include "em_cmu.h"
#include "em_prs.h"
#include "gpio.h"

//***********************************************************************************
// defined files
//***********************************************************************************

//uint32_t  frequency;                  /**< PLL frequency value, max 40 MHz. */
//uint16_t  n;                          /**< Factor N. 300 <= N <= 4095       */
//uint16_t  m;                          /**< Factor M. M <= 4095              */
//uint8_t   ssInterval;                 /**< Spread spectrum update interval. */
//uint8_t   ssAmplitude;                /**< Spread spectrum amplitude.       */
//CMU_DPLLClkSel_TypeDef    refClk;     /**< Reference clock selector.        */
//CMU_DPLLEdgeSel_TypeDef   edgeSel;    /**< Reference clock edge detect selector. */
//CMU_DPLLLockMode_TypeDef  lockMode;   /**< DPLL lock mode selector.         */
//bool      autoRecover;                /**< Enable automatic lock recovery.  */


/////////////// NEED TO MAKE SURE THIS IS PROPERLY CONFIGURED ////////////////////
#define		DPLL_FREQUENCY		2000000
#define		DPLL_N				300
#define		DPLL_M				100
#define		DPLL_ssInterval		0
#define 	DPLL_ssAmplitude	0
#define		DPLL_REFCLK			cmuDPLLClkSel_Hfxo
#define		DPLL_edge_SEL		cmuDPLLEdgeSel_Fall
#define		DPLL_LOCK_MODE		cmuDPLLLockMode_Phase
#define		DPLL_AUTO_RECOVER	true

//#define		LETIMER0_ROUTE_OUT0	LETIMER_ROUTELOC0_OUT0LOC_LOC28
//#define		LETIMER0_OUT0_EN	true
#define		CMU_ROUTE_OUT0	CMU_ROUTELOC0_CLKOUT0LOC_LOC4
#define		CMU_OUT0_EN		true

#define		DPLL_FAILHIGH_EVT 	0x00000001	// 0b0001
#define		DPLL_FAILLOW_EVT 	0x00000002	// 0b0010
#define		DPLL_RDY			0x00000003  // 0b0100


//***********************************************************************************
// global variables
//***********************************************************************************

//***********************************************************************************
// function prototypes
//***********************************************************************************
void app_peripheral_setup(void);
void app_dpll_open(uint32_t frequency, uint16_t n, uint16_t m, uint8_t ssInterval, uint8_t ssAmplitude, CMU_DPLLClkSel_TypeDef refClk, CMU_DPLLEdgeSel_TypeDef edgeSel, CMU_DPLLLockMode_TypeDef lockMode, bool autoRecover);
void scheduled_dpll_failhigh_evt (void);
void scheduled_dpll_faillow_evt (void);

